import{ay as E,r as w,H as V,bb as y,S as k,j as c,k as B,l as u,d as n,K as s,O as m,N as U,J as p,q as _,R as A,U as q,ag as F,F as N,bl as D}from"./index.56a92387.js";import{Q as h}from"./QTd.fe564553.js";import{Q as v}from"./QInput.0cff7bd7.js";import{Q as I}from"./QTable.263909d9.js";import{Q as P}from"./QFile.37ac99e7.js";import{Q as T,a as j}from"./QCard.8c045a72.js";import{Q as H}from"./QCardActions.daa47bf8.js";import{Q as J}from"./QForm.e03cbc1f.js";import{Q as K}from"./QDialog.de3b4cde.js";import{C as L}from"./ClosePopup.f3d94508.js";import"./use-key-composition.17d467c7.js";import"./QSelect.e9f24bbb.js";const M={class:"q-ma-md"},O=["src"],R={id:"edit-event"},G={class:"text-h5 q-ma-sm text-weight-bold"},W={class:"row"},X={class:"col q-px-md"},Y={class:"col q-px-md"},Z={class:"row"},ee={class:"col q-px-md"},te=u("span",null,"\u958B\u59CB\u65E5\u671F",-1),le={class:"col q-px-md"},ae=u("span",null,"\u7D50\u675F\u65E5\u671F",-1),oe={__name:"EventSetting",setup(z){const r=E(),g=w(!1),d=w(!1),f=w(""),b=w(!1),i=V([]);V([]);const t=V({idx:-1,_id:"",name:"",description:"",dateStart:"",dateEnd:"",place:"",image:void 0,number:0}),C=[{name:"image",required:!0,label:"\u5716\u7247",field:a=>a.image},{name:"name",required:!0,label:"\u6A19\u984C",field:a=>a.name},{name:"dateStart",required:!0,label:"\u958B\u59CB\u65E5\u671F",field:a=>a.dateStart,sortable:!0},{name:"dateEnd",required:!0,label:"\u7D50\u675F\u65E5\u671F",field:a=>a.dateEnd,sortable:!0},{name:"place",required:!0,label:"\u5730\u9EDE",field:a=>a.place,sortable:!0},{name:"other",label:"\u64CD\u4F5C"}],x=a=>{g.value=!0;const e=i.findIndex(l=>l._id===a);e===-1?(t._id="",t.name="",t.description="",t.dateStart="",t.dateEnd="",t.place="",t.image=void 0,t.number=0):(t._id=i[e]._id,t.idx=e,t.name=i[e].name,t.description=i[e].description,t.dateEnd=i[e].dateEnd,t.dateStart=i[e].dateStart,t.place=i[e].place,t.image=void 0,t.number=i[e].number,console.log(t))},$=async()=>{var e,l;g.value=!1,r.loading.show({spinner:D,spinnerColor:"warning",spinnerSize:100,backgroundColor:"black",message:"loading...",messageColor:"white"});const a=new FormData;a.append("name",t.name),a.append("description",t.description),a.append("dateStart",t.dateStart),a.append("dateEnd",t.dateEnd),a.append("place",t.place),a.append("image",t.image),a.append("number",t.number);try{if(t._id.length===0){const{data:o}=await y.post("/events",a);i.push(o.result),r.notify({type:"positive",color:"pink",message:"\u65B0\u589E\u6210\u529F",position:"top"})}else{const{data:o}=await y.patch("/events/"+t._id,a);i[t.idx]=o.result,r.notify({type:"positive",color:"pink",message:"\u7DE8\u8F2F\u5B8C\u6210",position:"top"})}}catch(o){k.fire({toast:!0,timer:1e3,showConfirmButton:!1,background:"#F5ABA5",icon:"error",color:"black",text:((l=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:l.message)||"\u767C\u751F\u932F\u8AA4\uFF01"})}r.loading.hide()},S=async a=>{var e,l;try{d.value=!0;const o=i.findIndex(Q=>Q._id===a);await y.delete("/events/"+a),i.splice(o,1),d.value=!1,r.notify({type:"positive",color:"pink",message:"\u5DF2\u522A\u9664\u6D3B\u52D5",position:"top"})}catch(o){k.fire({toast:!0,timer:1e3,showConfirmButton:!1,background:"#F5ABA5",icon:"error",color:"black",text:((l=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:l.message)||"\u767C\u751F\u932F\u8AA4\uFF01"})}};return(async()=>{var a,e;try{d.value=!0;const{data:l}=await y.get("/events");i.push(...l.result),d.value=!1}catch(l){k.fire({toast:!0,timer:1e3,showConfirmButton:!1,background:"#F5ABA5",icon:"error",color:"black",text:((e=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:e.message)||"\u5546\u54C1\u932F\u8AA4\uFF01"})}})(),(a,e)=>(c(),B(N,null,[u("div",M,[n(I,{id:"event-table",rows:i,columns:C,"row-key":"_id",filter:f.value,loading:d.value},{"body-cell-image":s(l=>[n(h,null,{default:s(()=>[u("img",{src:l.row.image,width:100,height:100},null,8,O)]),_:2},1024)]),"top-left":s(()=>[n(m,{label:"\u65B0\u589E\u6D3B\u52D5",color:"secondary",outline:"",onClick:e[0]||(e[0]=l=>x(-1))})]),"top-right":s(()=>[n(v,{class:"q-mr-md",borderless:"",dense:"",debounce:"300",modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=l=>f.value=l),placeholder:"Search"},{append:s(()=>[n(U,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-other":s(l=>[n(h,{class:"q-gutter-sm"},{default:s(()=>[b.value?_("",!0):(c(),p(m,{key:0,icon:"edit",round:"",unelevated:"",size:"sm",color:"pink",onClick:o=>x(l.row._id)},null,8,["onClick"])),b.value?(c(),p(m,{key:1,icon:"check",round:"",unelevated:"",size:"sm",color:"pink",onClick:e[2]||(e[2]=o=>b.value=!b.value)})):_("",!0),n(m,{icon:"delete",color:"pink",size:"sm",round:"",onClick:o=>S(l.row._id)},null,8,["onClick"])]),_:2},1024)]),_:1},8,["rows","filter","loading"])]),u("div",R,[n(K,{modelValue:g.value,"onUpdate:modelValue":e[10]||(e[10]=l=>g.value=l),persistent:"","transition-show":"fade","transition-hide":"fade"},{default:s(()=>[n(T,{class:"my-card text-white"},{default:s(()=>[n(J,{onSubmit:$},{default:s(()=>[n(j,{align:"center"},{default:s(()=>[u("div",G,A(t._id.length>0?"\u7DE8\u8F2F\u6D3B\u52D5":"\u65B0\u589E\u6D3B\u52D5"),1),n(v,{class:"q-my-xs",modelValue:t.name,"onUpdate:modelValue":e[3]||(e[3]=l=>t.name=l),label:"\u6A19\u984C",type:"text",color:"warning",rules:[a.$rules.required("\u6B04\u4F4D\u5FC5\u586B")]},null,8,["modelValue","rules"]),u("div",W,[u("div",X,[n(v,{class:"q-my-xs",modelValue:t.place,"onUpdate:modelValue":e[4]||(e[4]=l=>t.place=l),label:"\u5730\u9EDE",color:"warning"},null,8,["modelValue"])]),u("div",Y,[n(v,{class:"q-my-xs",modelValue:t.number,"onUpdate:modelValue":e[5]||(e[5]=l=>t.number=l),modelModifiers:{number:!0},label:"\u4EBA\u6578",type:"number",color:"warning",rules:[a.$rules.required("\u6B04\u4F4D\u5FC5\u586B")]},null,8,["modelValue","rules"])])]),u("div",Z,[u("div",ee,[te,n(v,{modelValue:t.dateStart,"onUpdate:modelValue":e[6]||(e[6]=l=>t.dateStart=l),filled:"",type:"date",borderless:""},null,8,["modelValue"])]),u("div",le,[ae,n(v,{modelValue:t.dateEnd,"onUpdate:modelValue":e[7]||(e[7]=l=>t.dateEnd=l),filled:"",type:"date",borderless:""},null,8,["modelValue"])])]),n(v,{class:"q-my-xs",modelValue:t.description,"onUpdate:modelValue":e[8]||(e[8]=l=>t.description=l),label:"\u8AAA\u660E",type:"textarea",color:"warning",autogrow:"",rows:"4",rules:[a.$rules.required("\u6B04\u4F4D\u5FC5\u586B")]},null,8,["modelValue","rules"]),n(P,{class:"q-my-xs",modelValue:t.image,"onUpdate:modelValue":e[9]||(e[9]=l=>t.image=l),outlined:"","use-chips":"",label:"\u914D\u5716"},null,8,["modelValue"])]),_:1}),n(H,{align:"center"},{default:s(()=>[n(m,{type:"submit",size:"md",color:"secondary"},{default:s(()=>[q("\u78BA\u5B9A")]),_:1}),F((c(),p(m,{size:"md",color:"pink"},{default:s(()=>[q("\u53D6\u6D88")]),_:1})),[[L]])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])],64))}};const ne={class:"q-ma-md"},se=["src"],ie={class:"text-h5 q-ma-sm text-weight-bold"},de={__name:"NewSetting",setup(z){const r=E(),g=w(!1),d=w(!1),f=w(""),b=w(!1),i=V([]),t=V({idx:-1,_id:"",title:"",content:"",date:"",image:void 0}),C=[{name:"image",required:!0,label:"\u5716\u7247"},{name:"date",required:!0,label:"\u767C\u5E03\u65E5\u671F",field:a=>a.date,format:a=>`${new Date(a).toLocaleString()}`,sortable:!0},{name:"title",required:!0,label:"\u6A19\u984C",field:"title"},{name:"content",required:!0,label:"\u5167\u6587",field:"content"},{name:"other",label:"\u64CD\u4F5C"}],x=a=>{g.value=!0,d.value=!0;const e=i.findIndex(l=>l._id===a);e===-1?(t._id="",t.title="",t.content="",t.date="",t.image=void 0):(t._id=i[e]._id,t.idx=e,t.title=i[e].title,t.content=i[e].content,t.date=i[e].date,t.image=void 0)},$=async()=>{var e,l;d.value=!0,r.loading.show({spinner:D,spinnerColor:"warning",spinnerSize:100,backgroundColor:"black",message:"loading...",messageColor:"white"});const a=new FormData;a.append("title",t.title),a.append("content",t.content),a.append("image",t.image);try{if(t._id.length===0){const{data:o}=await y.post("/news",a);i.push(o.result),r.notify({type:"positive",color:"pink",message:"\u65B0\u589E\u6210\u529F",position:"top"})}else{const{data:o}=await y.patch("/news/"+t._id,a);console.log(o.result),i[t.idx]=o.result,r.notify({type:"positive",color:"pink",message:"\u7DE8\u8F2F\u5B8C\u6210",position:"top"})}}catch(o){k.fire({toast:!0,timer:1e3,showConfirmButton:!1,background:"#F5ABA5",icon:"error",color:"black",text:((l=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:l.message)||"\u767C\u751F\u932F\u8AA4\uFF01"})}d.value=!1,g.value=!1,r.loading.hide()},S=async a=>{var e,l;try{const o=i.findIndex(Q=>Q._id===a);d.value=!0,await y.delete("/news/"+a),d.value=!1,i.splice(o,1),r.notify({type:"positive",color:"pink",message:"\u5DF2\u522A\u9664\u6D3B\u52D5",position:"top"})}catch(o){k.fire({toast:!0,timer:1e3,showConfirmButton:!1,background:"#F5ABA5",icon:"error",color:"black",text:((l=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:l.message)||"\u767C\u751F\u932F\u8AA4\uFF01"})}};return(async()=>{var a,e;try{d.value=!0;const{data:l}=await y.get("/news");i.push(...l.result),d.value=!1}catch(l){k.fire({toast:!0,timer:1e3,showConfirmButton:!1,background:"#F5ABA5",icon:"error",color:"black",text:((e=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:e.message)||"\u5546\u54C1\u932F\u8AA4\uFF01"})}})(),(a,e)=>(c(),B(N,null,[u("div",ne,[n(I,{class:"new-table",rows:i,columns:C,"row-key":"_id",filter:f.value,loading:d.value},{"body-cell-image":s(l=>[n(h,null,{default:s(()=>{var o;return[u("img",{src:(o=l.row)==null?void 0:o.image,width:100,height:100},null,8,se)]}),_:2},1024)]),"top-left":s(()=>[n(m,{label:"\u65B0\u589E\u516C\u544A",color:"secondary",outline:"",onClick:e[0]||(e[0]=l=>x(-1))})]),"top-right":s(()=>[n(v,{class:"q-mr-md",borderless:"",dense:"",debounce:"300",modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=l=>f.value=l),placeholder:"Search"},{append:s(()=>[n(U,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-other":s(l=>[n(h,{class:"q-gutter-sm"},{default:s(()=>[b.value?_("",!0):(c(),p(m,{key:0,icon:"edit",round:"",unelevated:"",size:"sm",color:"pink",onClick:o=>x(l.row._id)},null,8,["onClick"])),b.value?(c(),p(m,{key:1,icon:"check",round:"",unelevated:"",size:"sm",color:"pink",onClick:e[2]||(e[2]=o=>b.value=!b.value)})):_("",!0),n(m,{icon:"delete",color:"pink",size:"sm",round:"",onClick:o=>S(l.row._id)},null,8,["onClick"])]),_:2},1024)]),_:1},8,["rows","filter","loading"])]),n(K,{id:"edit-new",modelValue:g.value,"onUpdate:modelValue":e[7]||(e[7]=l=>g.value=l),persistent:"","transition-show":"fade","transition-hide":"fade"},{default:s(()=>[n(T,{class:"edit-new-card text-white"},{default:s(()=>[n(J,{onSubmit:$},{default:s(()=>[n(j,{align:"center"},{default:s(()=>[u("div",ie,[q(A(t._id.length>0?"\u7DE8\u8F2F\u516C\u544A":"\u65B0\u589E\u516C\u544A"),1),n(v,{class:"q-my-xs",modelValue:t.title,"onUpdate:modelValue":e[3]||(e[3]=l=>t.title=l),label:"\u6A19\u984C",type:"text",color:"warning",rules:[a.$rules.required("\u6B04\u4F4D\u5FC5\u586B")]},null,8,["modelValue","rules"]),n(v,{class:"q-my-xs",modelValue:t.content,"onUpdate:modelValue":e[4]||(e[4]=l=>t.content=l),label:"\u5167\u6587",type:"textarea",color:"warning",rows:"4",autogrow:"",rules:[a.$rules.required("\u6B04\u4F4D\u5FC5\u586B")]},null,8,["modelValue","rules"]),n(P,{class:"q-my-xs",modelValue:t.image,"onUpdate:modelValue":e[5]||(e[5]=l=>t.image=l),outlined:"","use-chips":""},null,8,["modelValue"])])]),_:1}),n(H,{align:"center"},{default:s(()=>[n(m,{type:"submit",size:"md",color:"secondary"},{default:s(()=>[q("submit")]),_:1}),F((c(),p(m,{size:"md",color:"pink",onClick:e[6]||(e[6]=l=>d.value=!1)},{default:s(()=>[q("cancel")]),_:1})),[[L]])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},re={class:"q-ma-md text-center"},ue={class:"q-gutter-md q-mb-md"},Ve={__name:"ViewPage",setup(z){const r=w("news");return(g,d)=>(c(),B("div",re,[u("div",ue,[r.value==="news"?(c(),p(m,{key:0,label:"\u516C\u544A\u7BA1\u7406",color:"secondary",size:"15px",push:"",onClick:d[0]||(d[0]=f=>r.value="news")})):(c(),p(m,{key:1,label:"\u516C\u544A\u7BA1\u7406",color:"secondary",size:"15px",outline:"",onClick:d[1]||(d[1]=f=>r.value="news")})),r.value==="events"?(c(),p(m,{key:2,label:"\u6D3B\u52D5\u7BA1\u7406",color:"pink",size:"15px",push:"",onClick:d[2]||(d[2]=f=>r.value="events")})):(c(),p(m,{key:3,label:"\u6D3B\u52D5\u7BA1\u7406",color:"pink",size:"15px",outline:"",onClick:d[3]||(d[3]=f=>r.value="events")}))]),r.value==="news"?(c(),p(de,{key:0})):_("",!0),r.value==="events"?(c(),p(oe,{key:1})):_("",!0)]))}};export{Ve as default};
